<div class="margin-30">
<a href="<?php echo admin_url( 'admin.php?page=swms_scanner_generate_report');?>" class="button sa-red-btn scan-btn">Back To Listing</a>
</div>
<?php 
if(isset($_REQUEST['swms_url'])){
$swms_url = $_REQUEST['swms_url'];
$allsites = swms_getSitereport($swms_url);

//print_r($allsites);
//echo $allsites[0]->scan_status;
$jsonData = $allsites[0]->scan_status;
}
?>

<div class="container">
<?php 
	if(isset($jsonData)){
	ini_set('display_errors',0); 
	
	function httpGet($url){
		$ch = curl_init();  
	 
		curl_setopt($ch,CURLOPT_URL,$url);
		curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
		//curl_setopt($ch,CURLOPT_HEADER, false); 
	 
		$output=curl_exec($ch);
		curl_close($ch);
		return $output;
	}
 	
	function is_iterable($var)
	{
		return $var !== null 
			&& (is_array($var) 
				|| $var instanceof Traversable 
				|| $var instanceof Iterator 
				|| $var instanceof IteratorAggregate
				);
	}


	$phpArray = json_decode($jsonData, true);             
	if(is_iterable($phpArray)){
	foreach ($phpArray as $key => $value) {
		
     if(is_iterable($value)){
    	echo "<h1 class='bg-primary text-capitalize text-center'>Scanner Report</h1>";
	//echo "<h3>$key</h3> ***** $value <br />";

    foreach ($value as $k => $v) {
	   //print_r($k);
	   //print_r($v);
	   $var1 = "blacklist_report";
	   if (strcasecmp($var1, $k) == 0){	
		echo "<pre>"; 
		}
		else{
		if(strcasecmp("files",$k) == 0){
			echo "<p class='text-green'>Files Scanned</p>";
		}
		else{
			
			if($k == "malicious_files" || $k == "psuspicious_files" || $k == "suspicious_files"){
				if($v > 0){
					echo "<p class='text-red zero-margin border-red'>$k - $v &nbsp;&nbsp;<a class='button sa-red-btn' href='http://sitesassure.com/index.php?option=com_content&view=article&id=112' target='_blank'>Clean Now</a></p>"; 
				}else{
					echo "<p class='text-green zero-margin border-green'>$k - $v</p>"; 
				}
			}elseif($k == "state" && $v != "clean"){
				echo "<p class='text-red zero-margin border-red'>$k - $v &nbsp;&nbsp;<a class='button sa-red-btn' href='http://sitesassure.com/index.php?option=com_content&view=article&id=112' target='_blank'>Clean Now</a></p>"; 
			}else{
				echo "<p class='text-green zero-margin border-green'>$k - $v</p>"; 
			}
		}
		}
		if(is_iterable($v)){
		echo "<div class='text-capitalize'>";
		foreach ($v as $nk => $nv){
			if (is_numeric($nk)){
				  //echo "$nk----------------<br />";
			 }
			 else{
				if(strcasecmp("providers",$nk) == 0){
					echo "<p class='text-green'>Scanned on</p>";
				}else{
					if($nv == "NoThreat"){
					$nnk = str_replace("<","&lt;",$nk );
					echo "<p class='zero-margin text-capitalize'>$nnk - <b class='text-green'>$nv</b></p>";
					}else{
					echo "<p class='zero-margin text-capitalize'>$nk - <b class='text-red'>$nv</b></p>";
					}
				}
		     }
			 
	  	    if(is_iterable($nv)){
			  foreach ($nv as $nl1 => $nest){
			  if (is_numeric($nl1)) {
			  //echo "$nl1----------------<br />";
			  //echo "$nl1 | $nest <br />"; 
			  }
			  else{
			  	echo "$nl1 : $nest";
			  } 
			  echo "<p class='text-capitalize zero-margin'>";
			  foreach ($nest as $nl2 => $nest2){
			  	echo "<br/>";
			  	if($nl2 == 'time'){ 
				$date = new DateTime();
				$date->setTimestamp($nest2);
				$nest2 = $date->format('Y-m-d h:i A');
				echo "$nl2 : $nest2"; 
				}else{
			  		echo "$nl2 : $nest2"; 
				}
			    
			  }echo "</p>";
			  
			 }

			  }
			 
			 
		} 
		
		echo "</div>"; 
		} //
	
 } ?>

</pre> <!---Blacklist Report---> 

<?php }


}
}

}else{echo "<div class='margin-30'>You have no permission to directly access this page, please scan the anyone of the url first.</div>";}	
	?>
</div>

<div class="margin-30">
<a href="<?php echo admin_url( 'admin.php?page=swms_scanner_generate_report');?>" class="button sa-red-btn scan-btn">Back To Listing</a>
</div>